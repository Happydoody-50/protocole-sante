<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#111827">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Protocole Sant√©</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #111827; color: white; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .container { max-width: 480px; margin: 0 auto; padding: 16px; padding-bottom: 80px; }
        .header { text-align: center; padding: 20px 0; }
        .header h1 { font-size: 28px; font-weight: bold; background: linear-gradient(135deg, #60a5fa, #a78bfa); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .header p { color: #9ca3af; font-size: 14px; margin-top: 4px; }
        .date-picker { background: #1f2937; color: white; padding: 8px 12px; border-radius: 8px; border: 1px solid #374151; width: 100%; max-width: 200px; font-size: 14px; }
        .section { background: #1f2937; border-radius: 12px; padding: 20px; margin-bottom: 16px; border: 1px solid #374151; }
        .section-title { font-size: 20px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        .supplement-btn { width: 100%; padding: 16px; background: #374151; border: 2px solid transparent; border-radius: 8px; color: white; font-size: 15px; font-weight: 500; text-align: left; display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; transition: all 0.2s; cursor: pointer; }
        .supplement-btn:active { transform: scale(0.98); }
        .supplement-btn.checked { background: rgba(34, 197, 94, 0.2); border-color: #22c55e; }
        .supplement-btn.disabled { background: #374151; opacity: 0.5; cursor: not-allowed; }
        .check-icon { width: 24px; height: 24px; border-radius: 50%; border: 2px solid #9ca3af; display: flex; align-items: center; justify-content: center; }
        .check-icon.checked { background: #22c55e; border-color: #22c55e; }
        .wellbeing-section { background: linear-gradient(135deg, rgba(109, 40, 217, 0.3), rgba(59, 130, 246, 0.3)); border-color: #7c3aed; }
        .slider-container { margin-bottom: 16px; }
        .slider-label { color: #e5e7eb; font-weight: 500; margin-bottom: 8px; display: block; }
        .slider-row { display: flex; align-items: center; gap: 12px; }
        .slider { flex: 1; height: 8px; border-radius: 4px; appearance: none; outline: none; cursor: pointer; }
        .slider::-webkit-slider-thumb { appearance: none; width: 20px; height: 20px; border-radius: 50%; background: #a78bfa; cursor: pointer; }
        .slider-value { font-size: 24px; font-weight: bold; color: #c4b5fd; min-width: 48px; text-align: center; }
        .completion-box { background: #1f2937; border: 1px solid #374151; border-radius: 12px; padding: 20px; text-align: center; margin-bottom: 16px; }
        .completion-value { font-size: 48px; font-weight: bold; color: #60a5fa; }
        .completion-label { color: #9ca3af; margin-top: 8px; }
        .week-chart { margin-top: 16px; }
        .week-row { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
        .week-day { width: 60px; color: #9ca3af; font-weight: 500; font-size: 14px; }
        .progress-bar { flex: 1; height: 32px; background: #374151; border-radius: 16px; overflow: hidden; position: relative; }
        .progress-fill { height: 100%; transition: width 0.3s; }
        .progress-fill.green { background: #22c55e; }
        .progress-fill.yellow { background: #eab308; }
        .progress-fill.red { background: #ef4444; }
        .progress-text { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 14px; color: white; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 8px; margin-top: 16px; }
        .calendar-header { text-align: center; color: #9ca3af; font-size: 12px; font-weight: 500; padding: 8px 0; }
        .calendar-day { aspect-ratio: 1; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; transition: transform 0.2s; border: none; color: white; }
        .calendar-day:active { transform: scale(0.95); }
        .calendar-day.empty { background: transparent; cursor: default; }
        .calendar-day.high { background: #22c55e; }
        .calendar-day.medium { background: #eab308; }
        .calendar-day.low { background: #f97316; }
        .calendar-day.none { background: #374151; }
        .calendar-day.today { box-shadow: 0 0 0 2px #60a5fa; }
        .calendar-day-num { font-size: 18px; }
        .calendar-day-percent { font-size: 10px; margin-top: 2px; }
        .legend { margin-top: 20px; }
        .legend-item { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .legend-color { width: 32px; height: 32px; border-radius: 4px; }
        .legend-text { color: #d1d5db; }
        .bottom-nav { position: fixed; bottom: 0; left: 0; right: 0; background: #1f2937; border-top: 1px solid #374151; display: flex; justify-content: space-around; padding: 12px 0; z-index: 1000; }
        .nav-btn { display: flex; flex-direction: column; align-items: center; gap: 4px; padding: 8px 24px; background: transparent; border: none; border-radius: 8px; color: #9ca3af; cursor: pointer; transition: all 0.2s; }
        .nav-btn.active { color: #60a5fa; background: rgba(59, 130, 246, 0.2); }
        .nav-icon { width: 24px; height: 24px; }
        .nav-label { font-size: 12px; font-weight: 500; }
        .view { display: none; }
        .view.active { display: block; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .month-title { text-align: center; font-size: 20px; color: #d1d5db; text-transform: capitalize; margin-bottom: 16px; }
        .avg-score-section { background: #1f2937; border: 1px solid #374151; border-radius: 12px; padding: 20px; margin-bottom: 16px; }
        .score-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .score-label { color: #e5e7eb; font-weight: 500; }
        .score-bar-container { display: flex; align-items: center; gap: 8px; }
        .score-bar { width: 128px; height: 12px; background: #374151; border-radius: 6px; overflow: hidden; }
        .score-bar-fill { height: 100%; background: #a78bfa; transition: width 0.3s; }
        .score-number { color: #c4b5fd; font-weight: bold; min-width: 32px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíä Protocole Sant√©</h1>
            <p>Suivi de suppl√©mentation</p>
        </div>
        
        <div id="dailyView" class="view active">
            <div class="flex-between">
                <h2 style="font-size: 24px; font-weight: bold;">Protocole Quotidien</h2>
                <input type="date" id="dateInput" class="date-picker">
            </div>
            
            <div class="section">
                <div class="section-title">üåÖ Matin</div>
                <div id="matinSupplements"></div>
            </div>
            
            <div class="section">
                <div class="section-title">‚òÄÔ∏è Midi</div>
                <div id="midiSupplements"></div>
            </div>
            
            <div class="section">
                <div class="section-title">üåô Soir</div>
                <div id="soirSupplements"></div>
            </div>
            
            <div class="section wellbeing-section">
                <div class="section-title">üí´ Bien-√™tre du jour</div>
                <div class="slider-container">
                    <label class="slider-label">√ânergie</label>
                    <div class="slider-row">
                        <input type="range" min="0" max="10" value="5" class="slider" id="energieSlider">
                        <span class="slider-value" id="energieValue">5</span>
                    </div>
                </div>
                <div class="slider-container">
                    <label class="slider-label">Immunit√©</label>
                    <div class="slider-row">
                        <input type="range" min="0" max="10" value="5" class="slider" id="immuniteSlider">
                        <span class="slider-value" id="immuniteValue">5</span>
                    </div>
                </div>
                <div class="slider-container">
                    <label class="slider-label">Stress</label>
                    <div class="slider-row">
                        <input type="range" min="0" max="10" value="5" class="slider" id="stressSlider">
                        <span class="slider-value" id="stressValue">5</span>
                    </div>
                </div>
            </div>
            
            <div class="completion-box">
                <div class="completion-value" id="dailyCompletion">0%</div>
                <div class="completion-label">Protocole compl√©t√© aujourd'hui</div>
            </div>
        </div>
        
        <div id="weeklyView" class="view">
            <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 16px;">üìä Analyse Hebdomadaire</h2>
            
            <div class="section" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.3), rgba(59, 130, 246, 0.3)); border-color: #22c55e;">
                <div style="text-align: center;">
                    <div style="font-size: 56px; font-weight: bold; color: #22c55e; margin-bottom: 8px;" id="weeklyAvg">0%</div>
                    <div style="color: #d1d5db; font-size: 18px;">Conformit√© moyenne cette semaine</div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title" style="color: #60a5fa;">Suivi quotidien</div>
                <div class="week-chart" id="weekChart"></div>
            </div>
            
            <div class="avg-score-section">
                <div class="section-title" style="color: #a78bfa;">Bien-√™tre moyen</div>
                <div id="avgScores"></div>
            </div>
        </div>
        
        <div id="monthlyView" class="view">
            <h2 style="font-size: 24px; font-weight: bold; margin-bottom: 16px;">üìÖ Vue Mensuelle</h2>
            <div class="month-title" id="monthTitle"></div>
            
            <div class="section">
                <div class="calendar-grid">
                    <div class="calendar-header">Dim</div>
                    <div class="calendar-header">Lun</div>
                    <div class="calendar-header">Mar</div>
                    <div class="calendar-header">Mer</div>
                    <div class="calendar-header">Jeu</div>
                    <div class="calendar-header">Ven</div>
                    <div class="calendar-header">Sam</div>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>
            
            <div class="section">
                <h3 style="font-size: 18px; font-weight: 600; margin-bottom: 12px;">L√©gende</h3>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #22c55e;"></div>
                        <span class="legend-text">80-100% compl√©t√©</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #eab308;"></div>
                        <span class="legend-text">50-79% compl√©t√©</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #f97316;"></div>
                        <span class="legend-text">1-49% compl√©t√©</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #374151;"></div>
                        <span class="legend-text">Non commenc√©</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="bottom-nav">
        <button class="nav-btn active" onclick="switchView('daily')">
            <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            <span class="nav-label">Quotidien</span>
        </button>
        <button class="nav-btn" onclick="switchView('weekly')">
            <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/></svg>
            <span class="nav-label">Semaine</span>
        </button>
        <button class="nav-btn" onclick="switchView('monthly')">
            <svg class="nav-icon" fill="currentColor" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"/></svg>
            <span class="nav-label">Mois</span>
        </button>
    </div>

    <script>
        const protocol = {
            matin: ['Bleu de M√©thyl√®ne', 'Sel Celtique', 'Complexe B', 'Moringa/Alfalfa', 'Optiflora', 'Vita-D3 + L√©cithine'],
            midi: ['Gouttes Folate B9/B12', 'Cr√©atine (3-5g)', 'Collag√®ne', 'Curcuma/Gingembre'],
            soir: ['Synermag (coucher)', 'Ashwagandha (d√Æner)', 'Zinc (d√Æner)']
        };
        
        let dailyData = JSON.parse(localStorage.getItem('supplementData') || '{}');
        let wellbeingScores = JSON.parse(localStorage.getItem('wellbeingScores') || '{}');
        let currentDate = new Date().toISOString().split('T')[0];
        
        function saveData() {
            localStorage.setItem('supplementData', JSON.stringify(dailyData));
            localStorage.setItem('wellbeingScores', JSON.stringify(wellbeingScores));
        }
        
        function isAshwagandhaRestDay(date) {
            const day = new Date(date).getDate();
            return day % 7 === 0 || day % 7 === 1;
        }
        
        function toggleSupplement(moment, supplement) {
            const key = `${currentDate}-${moment}-${supplement}`;
            dailyData[key] = !dailyData[key];
            saveData();
            renderDaily();
            updateDailyCompletion();
        }
        
        function renderDaily() {
            ['matin', 'midi', 'soir'].forEach(moment => {
                const container = document.getElementById(`${moment}Supplements`);
                container.innerHTML = '';
                
                protocol[moment].forEach(supp => {
                    const isAshwa = supp.includes('Ashwagandha');
                    const isRestDay = isAshwa && isAshwagandhaRestDay(currentDate);
                    const key = `${currentDate}-${moment}-${supp}`;
                    const isChecked = dailyData[key];
                    
                    const btn = document.createElement('button');
                    btn.className = `supplement-btn ${isChecked ? 'checked' : ''} ${isRestDay ? 'disabled' : ''}`;
                    btn.disabled = isRestDay;
                    btn.onclick = () => !isRestDay && toggleSupplement(moment, supp);
                    
                    btn.innerHTML = `
                        <span>${supp}${isRestDay ? ' <span style="color: #fb923c; font-size: 12px;">(Repos)</span>' : ''}</span>
                        <div class="check-icon ${isChecked ? 'checked' : ''}">
                            ${isChecked ? '‚úì' : ''}
                        </div>
                    `;
                    
                    container.appendChild(btn);
                });
            });
        }
        
        function getDayCompletion(date) {
            let total = 0, completed = 0;
            
            Object.keys(protocol).forEach(moment => {
                protocol[moment].forEach(supp => {
                    if (supp.includes('Ashwagandha') && isAshwagandhaRestDay(date)) return;
                    total++;
                    const key = `${date}-${moment}-${supp}`;
                    if (dailyData[key]) completed++;
                });
            });
            
            return total > 0 ? Math.round((completed / total) * 100) : 0;
        }
        
        function updateDailyCompletion() {
            document.getElementById('dailyCompletion').textContent = getDayCompletion(currentDate) + '%';
        }
        
        function renderWeekly() {
            const today = new Date(currentDate);
            const weekData = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                weekData.push({
                    date: dateStr,
                    day: date.toLocaleDateString('fr-FR', { weekday: 'short' }),
                    completion: getDayCompletion(dateStr)
                });
            }
            
            const avgCompletion = Math.round(weekData.reduce((sum, d) => sum + d.completion, 0) / weekData.length);
            document.getElementById('weeklyAvg').textContent = avgCompletion + '%';
            
            const chartContainer = document.getElementById('weekChart');
            chartContainer.innerHTML = '';
            
            weekData.forEach(day => {
                const row = document.createElement('div');
                row.className = 'week-row';
                const color = day.completion >= 80 ? 'green' : day.completion >= 50 ? 'yellow' : 'red';
                
                row.innerHTML = `
                    <div class="week-day">${day.day}</div>
                    <div class="progress-bar">
                        <div class="progress-fill ${color}" style="width: ${day.completion}%"></div>
                        <div class="progress-text">${day.completion}%</div>
                    </div>
                `;
                
                chartContainer.appendChild(row);
            });
            
            const avgScores = {};
            ['√ânergie', 'Immunit√©', 'Stress'].forEach(cat => {
                const scores = weekData
                    .map(d => wellbeingScores[d.date]?.[cat])
                    .filter(s => s !== undefined);
                avgScores[cat] = scores.length > 0
                    ? Math.round(scores.reduce((a, b) => a + b, 0) / scores.length)
                    : 0;
            });
            
            const scoresContainer = document.getElementById('avgScores');
            scoresContainer.innerHTML = '';
            
            Object.entries(avgScores).forEach(([cat, score]) => {
                const item = document.createElement('div');
                item.className = 'score-item';
                item.innerHTML = `
                    <span class="score-label">${cat}</span>
                    <div class="score-bar-container">
                        <div class="score-bar">
                            <div class="score-bar-fill" style="width: ${score * 10}%"></div>
                        </div>
                        <span class="score-number">${score}</span>
                    </div>
                `;
                scoresContainer.appendChild(item);
            });
        }
        
        function renderMonthly() {
            const today = new Date(currentDate);
            const year = today.getFullYear();
            const month = today.getMonth();
            
            document.getElementById('monthTitle').textContent = today.toLocaleDateString('fr-FR', { month: 'long', year: 'numeric' });
            
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            for (let i = 0; i < startingDayOfWeek; i++) {
                const empty = document.createElement('div');
                empty.className = 'calendar-day empty';
                grid.appendChild(empty);
            }
            
            const todayStr = new Date().toISOString().split('T')[0];
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = date.toISOString().split('T')[0];
                const completion = getDayCompletion(dateStr);
                
                const btn = document.createElement('button');
                btn.className = 'calendar-day';
                if (completion >= 80) btn.classList.add('high');
                else if (completion >= 50) btn.classList.add('medium');
                else if (completion > 0) btn.classList.add('low');
                else btn.classList.add('none');
                
                if (dateStr === todayStr) btn.classList.add('today');
                
                btn.onclick = () => {
                    currentDate = dateStr;
                    document.getElementById('dateInput').value = dateStr;
                    switchView('daily');
                };
                
                btn.innerHTML = `
                    <div class="calendar-day-num">${day}</div>
                    ${completion > 0 ? `<div class="calendar-day-percent">${completion}%</div>` : ''}
                `;
                
                grid.appendChild(btn);
            }
        }
        
        function switchView(view) {
            document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            document.getElementById(`${view}View`).classList.add('active');
            event.currentTarget.classList.add('active');
            
            if (view === 'weekly') renderWeekly();
            if (view === 'monthly') renderMonthly();
        }
        
        function updateSliderValue(sliderId, valueId) {
            const slider = document.getElementById(sliderId);
            const value = document.getElementById(valueId);
            const category = sliderId.replace('Slider', '');
            const categoryName = category.charAt(0).toUpperCase() + category.slice(1);
            
            slider.oninput = function() {
                value.textContent = this.value;
                
                if (!wellbeingScores[currentDate]) {
                    wellbeingScores[currentDate] = {};
                }
                wellbeingScores[currentDate][categoryName] = parseInt(this.value);
                saveData();
                
                const percent = (this.value / 10) * 100;
                this.style.background = `linear-gradient(to right, #a78bfa 0%, #a78bfa ${percent}%, #374151 ${percent}%, #374151 100%)`;
            };
            
            const savedValue = wellbeingScores[currentDate]?.[categoryName] || 5;
            slider.value = savedValue;
            value.textContent = savedValue;
            const percent = (savedValue / 10) * 100;
            slider.style.background = `linear-gradient(to right, #a78bfa 0%, #a78bfa ${percent}%, #374151 ${percent}%, #374151 100%)`;
        }
        
        document.getElementById('dateInput').value = currentDate;
        document.getElementById('dateInput').onchange = function() {
            currentDate = this.value;
            renderDaily();
            updateDailyCompletion();
            
            ['energie', 'immunite', 'stress'].forEach(cat => {
                const slider = document.getElementById(`${cat}Slider`);
                const value = document.getElementById(`${cat}Value`);
                const categoryName = cat.charAt(0).toUpperCase() + cat.slice(1);
                const savedValue = wellbeingScores[currentDate]?.[categoryName] || 5;
                slider.value = savedValue;
                value.textContent = savedValue;
                const percent = (savedValue / 10) * 100;
                slider.style.background = `linear-gradient(to right, #a78bfa 0%, #a78bfa ${percent}%, #374151 ${percent}%, #374151 100%)`;
            });
        };
        
        updateSliderValue('energieSlider', 'energieValue');
        updateSliderValue('immuniteSlider', 'immuniteValue');
        updateSliderValue('stressSlider', 'stressValue');
        
        renderDaily();
        updateDailyCompletion();
    </script>
</body>
</html>